<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Travel</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link rel="shortcut icon" sizes="48x48" href="img/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="img/apple-touch-icon.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="img/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="android-chrome-512x512.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="android-chrome-192x192.png"
    />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />

    <!-- Chrome can use this to set background color. -->
    <meta name="theme-color" content="#E9EBEE" />

    <!-- Bootstrap theme - Bootswatch Readable -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <!-- jQuery file, must be put before Bootstrap javascript file -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="jquery-jvectormap-2.0.3.css"
      type="text/css"
      media="screen"
    />
    <!-- <script src="jquery-3.4.1.js"></script> -->
    <script
      src="https://code.jquery.com/jquery-1.12.4.js"
      integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU="
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
    <script src="https://cdn.anychart.com/releases/v8/js/anychart-map.min.js?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"></script>
    <script src="https://cdn.anychart.com/geodata/2.0.0/custom/world/world.js"></script>
    <script src="https://cdn.anychart.com/geodata/2.0.0/countries/china/china.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
    <script src="https://cdn.anychart.com/releases/v8/themes/light_earth.min.js"></script>
    <link
      href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"
      type="text/css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.anychart.com/releases/v8/fonts/css/anychart-font.min.css?hcode=c11e6e3cfefb406e8ce8d99fa8368d33"
      type="text/css"
      rel="stylesheet"
    />

    <script src="visit_freq.js"></script>
    <!-- Customize css file. -->
    <link rel="stylesheet" href="../assets/style.css" />
  </head>

  <body>
    <div class="bg-img">
      <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
        <a class="navbar-brand" href="../index.html">He Yingxu</a>
        <div class="navbar-header">
          <!-- shown on small screens -->
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="nav navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="projects.html">Projects</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="experience.html">Experience</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="travel.html">Travel</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <br /><br /><br />

    <div
      id="container"
      style="width: 1200px; height: 500px; margin: 0 auto;"
    ></div>
    <script>
      var generateData, getData;

      anychart.onDocumentReady(function() {
        // set chart theme
        anychart.theme("lightEarth");
        var preloader = anychart.ui.preloader();
        preloader.render(document.getElementById("container"));

        var map = anychart.map();

        map
          .unboundRegions()
          .enabled(true)
          .fill("#E1E1E1")
          .stroke("#D2D2D2");

        // sets geo data
        map.geoData("anychart.maps.world");

        // sets title settings
        map
          .title()
          .useHtml(true)
          .enabled(true)
          .padding([0, 0, 20, 0])
          .text(
            'Travelling frequency indicated by color. <br/><span style="color:#212121; font-size: 13px;">' +
              "<br> To drill up Press Backspace button or use context menu</span>"
          );

        var menu = map.contextMenu();
        // add item DrillUp for context menu
        menu.itemsFormatter(function(items) {
          var path = map.getDrilldownPath();

          items["drill-up"] = {
            index: 0,
            text: "Drill Up",
            action: function() {
              map.drillUp();
            }
          };

          path.length <= 1
            ? (items["drill-up"].enabled = false)
            : (items["drill-up"].enabled = true);

          return items;
        });

        // sets settings for map chart
        map.padding([10, 10, 10, 10]);
        map.interactivity().selectionMode("none");

        var series = map
          .choropleth(world_freq)
          .stroke("#D3E1F3")
          .colorScale(
            anychart.scales.linearColor(
              "#CBE1F2",
              "#67A0CB",
              "#226BA4",
              "#044E86"
            )
          );

        series
          .hovered()
          .fill("#D3E1F3")
          .stroke(anychart.color.darken("#D3E1F3"));

        series
          .tooltip()
          .enabled(true)
          .useHtml(true)
          .padding([8, 13, 10, 13])
          .fontSize(13)
          .titleFormat(function() {
            return this.getData("name");
          })
          .format(function() {
            return (
              '<span style="font-size: 12px; color: #cbcbcb">Frequency: </span> ' +
              this.getData("value") +
              '<span style="font-size: 12px; color: #cbcbcb"></span>'
            );
          });

        map.colorRange(true);

        // create zoom controls
        var zoomController = anychart.ui.zoom();
        zoomController.render(map);

        map.container("container");

        map.draw();

        map.listen("pointClick", function(evt) {
          var point = evt.point;
          var id = point.get("id");
          var name = point.get("name");
          var c_url_name = point
            .get("name")
            .toLowerCase()
            .replace(/\s/g, "_");
          console.log(c_url_name);
          if (country_freq[id]) {
            var middle_name;

            if (id == "CN") {
              middle_name = "countries";
            } else {
              middle_name = "china_areas";
            }
            var url =
              "https://cdn.anychart.com/geodata/2.0.0/" +
              middle_name +
              "/" +
              c_url_name +
              "/" +
              c_url_name +
              ".js";
            $.ajax({
              type: "GET",
              url: url,
              dataType: "script",
              beforeSend: function() {
                preloader.visible(true);
              },
              success: function() {
                var geoData = "anychart.maps." + c_url_name;
                var drillMap = anychart.map();
                var drillDownTitle =
                  'Traveling Frequency in <span style="color:#212121; font-weight: bold">' +
                  name +
                  '</span><br/><span style="color:#212121; font-size: 13px;"><br> To drill up Press Backspace button or use context menu</span>';
                drillMap.padding([10, 10, 10, 10]);
                drillMap
                  .title()
                  .enabled(true)
                  .padding([0, 0, 20, 0])
                  .useHtml(true)
                  .text(drillDownTitle);
                drillMap.geoData(geoData);

                var dataSet = anychart.data.set(country_freq[id]).mapAs();
                var series = drillMap.choropleth(dataSet);
                series.stroke("#CBE1F2");
                series
                  .hovered()
                  .fill("#D3E1F3")
                  .stroke(anychart.color.darken("#D3E1F3"));
                series.colorScale(
                  anychart.scales.linearColor(
                    "#CBE1F2",
                    "#67A0CB",
                    "#226BA4",
                    "#044E86"
                  )
                );
                series.tooltip().titleFormat(function() {
                  return this.getData("name");
                });
                series
                  .tooltip()
                  .enabled(true)
                  .useHtml(true)
                  .padding([8, 13, 10, 13])
                  .fontSize(13)
                  .format(function() {
                    return (
                      '<span style="font-size: 12px; color: #cbcbcb">Frequency: </span> ' +
                      this.getData("value") +
                      '<span style="font-size: 12px; color: #cbcbcb"></span>'
                    );
                  });

                drillMap.listen("pointClick", function(evt) {
                  var point = evt.point;
                  var id = point.get("id");
                  var name = point.get("name");
                  var url_name = point
                    .get("name")
                    .toLowerCase()
                    .replace(/\s/g, "_");
                  console.log(id);

                  if (china_regions_freq[id]) {
                    var url =
                      "https://cdn.anychart.com/geodata/2.0.0/" +
                      c_url_name +
                      "_areas/" +
                      url_name +
                      "/" +
                      url_name +
                      ".js";
                    $.ajax({
                      type: "GET",
                      url: url,
                      dataType: "script",
                      beforeSend: function() {
                        preloader.visible(true);
                      },
                      success: function() {
                        var geoData = "anychart.maps." + url_name;
                        var second_drillMap = anychart.map();
                        var drillDownTitle =
                          'Traveling Frequency in <span style="color:#212121; font-weight: bold">' +
                          name +
                          '</span><br/><span style="color:#212121; font-size: 13px;"><br> To drill up Press Backspace button or use context menu</span>';
                        second_drillMap.padding([10, 10, 10, 10]);
                        second_drillMap
                          .title()
                          .enabled(true)
                          .padding([0, 0, 20, 0])
                          .useHtml(true)
                          .text(drillDownTitle);
                        second_drillMap.geoData(geoData);

                        var dataSet = anychart.data
                          .set(china_regions_freq[id])
                          .mapAs();
                        var series = second_drillMap.choropleth(dataSet);
                        series.stroke("#CBE1F2");
                        series
                          .hovered()
                          .fill("#D3E1F3")
                          .stroke(anychart.color.darken("#D3E1F3"));
                        series.colorScale(
                          anychart.scales.linearColor(
                            "#CBE1F2",
                            "#67A0CB",
                            "#226BA4",
                            "#044E86"
                          )
                        );
                        series.tooltip().titleFormat(function() {
                          return this.getData("name");
                        });
                        series
                          .tooltip()
                          .enabled(true)
                          .useHtml(true)
                          .padding([8, 13, 10, 13])
                          .fontSize(13)
                          .format(function() {
                            return (
                              '<span style="font-size: 12px; color: #cbcbcb">Frequency: </span> ' +
                              this.getData("value") +
                              '<span style="font-size: 12px; color: #cbcbcb"></span>'
                            );
                          });
                        drillMap.drillTo(id, second_drillMap);
                        preloader.visible(false);
                      },
                      error: function(data) {
                        console.log("Error: ", data);
                      }
                    });
                  }
                });
                map.drillTo(id, drillMap);
                preloader.visible(false);
              },
              error: function(data) {
                console.log("Error: ", data);
              }
            });
          }
        });
      });

      // $(function(){
      //   new jvm.MultiMap({
      //     container: $('#world-map'),
      //     maxLevel: 1,
      //     main: {
      //       map: 'world_mill',
      //       backgroundColor: '#a5bfdd',
      //       series: {
      //         regions: [{
      //           values: freqData,
      //           scale: ['#C8EEFF', '#0071A4'],
      //           normalizeFunction: 'polynomial'
      //         }]
      //       },
      //       onRegionTipShow: function(e, el, code){
      //         el.html(el.html()+' (Frequency - '+freqData[code]+')');
      //       }
      //     },
      //     mapUrlByCode: function(code, multiMap){
      //       return 'jquery-jvectormap-cn'+'-mill.js';
      //     }
      //   });
      // });
    </script>
  </body>
</html>
